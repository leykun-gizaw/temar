# Define the upstream server (our Next.js app)
upstream nextjs_server {
  server web:5173; # 'web' is the service name from docker-compose
}

server {
  listen 80;
  server_name leyk14.com;

  # --- This is the ONLY root directive ---
  # All files will be served from this directory
  root /var/www/html;

  # --- Static File Serving ---
  
  # Handles: /_next/static/css/file.css
  # Looks for: /var/www/html/_next/static/css/file.css
  location /_next/static/ {
    expires 1y;
    access_log off;
  }

  # Handles: /favicon.ico AND /dashboard
  location / {
    # NO 'root' directive here!
    
    # Tries to find the file first (e.g., /var/www/html/favicon.ico)
    # If not found, it passes to the app (e.g., /dashboard)
    try_files $uri @proxy_to_app;
  }
  # -------------------------

  # --- Proxy to Next.js ---
  location @proxy_to_app {
    proxy_pass http://nextjs_server;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
  }
}